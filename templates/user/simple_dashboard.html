{% extends 'base.html' %}

{% block title %}Cold Room Monitor{% endblock %}

{% block content %}
<div class="simple-dashboard">
    <!-- Header Section -->
    <div class="header-section">
        <div class="header-container">
            <h1 class="site-title">
                <i class="fas fa-thermometer-half"></i>
                {% if location %}{{ location.name }}{% else %}Cold Room Monitor{% endif %}
            </h1>

            {% if current_user.is_admin() and all_locations %}
            <div class="location-selector-container">
                <select class="location-selector" onchange="changeLocation(this.value)">
                    <option value="">Select Location</option>
                    {% for loc in all_locations %}
                        <option value="{{ loc.id }}" {% if selected_location_id == loc.id %}selected{% endif %}>
                            {{ loc.name }}
                        </option>
                    {% endfor %}
                </select>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        {% if location and cold_rooms %}
            {% for room in cold_rooms %}
            <!-- Temperature Bubble Card -->
            <div class="temp-bubble-card">
                <!-- Online/Offline Status (Top Right) -->
                <div class="status-indicator-corner">
                    {% if room.latest_temp is not none %}
                        <span class="status-badge online">
                            <i class="fas fa-wifi"></i>
                            Online
                        </span>
                    {% else %}
                        <span class="status-badge offline">
                            <i class="fas fa-wifi-slash"></i>
                            Offline
                        </span>
                    {% endif %}
                </div>

                <!-- Room Name -->
                <div class="room-title">
                    <h2>{{ room.name }}</h2>
                </div>

                <!-- Main Temperature Layout -->
                <div class="temp-layout">
                    <!-- Left Side: Big Current Temperature -->
                    <div class="current-temp-section">
                        {% if room.latest_temp is not none %}
                            <div class="big-temperature">
                                {{ "%.1f"|format(room.latest_temp) }}째C
                            </div>
                            <!-- Received Time (Below Temperature) -->
                            <div class="received-time">
                                {% if room.latest_time %}
                                    Received: {{ room.latest_time }}
                                {% else %}
                                    Received: Just now
                                {% endif %}
                            </div>
                        {% else %}
                            <div class="no-data-temp">
                                <i class="fas fa-question-circle"></i>
                                <span>No Data</span>
                            </div>
                            <div class="received-time offline">
                                No signal received
                            </div>
                        {% endif %}
                    </div>

                    <!-- Right Side: Stats (Avg, Min, Max) -->
                    <div class="stats-section">
                        {% if room.avg_temp is not none %}
                            <div class="stat-item avg">
                                <span class="stat-label">Average</span>
                                <span class="stat-value">{{ room.avg_temp }}째C</span>
                            </div>
                            <div class="stat-item min">
                                <span class="stat-label">Lowest</span>
                                <span class="stat-value">{{ room.min_temp }}째C</span>
                            </div>
                            <div class="stat-item max">
                                <span class="stat-label">Highest</span>
                                <span class="stat-value">{{ room.max_temp }}째C</span>
                            </div>
                        {% else %}
                            <div class="no-stats">
                                <i class="fas fa-chart-line"></i>
                                <span>No 24h data</span>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endfor %}

        {% else %}
            <!-- No Data State -->
            <div class="no-data-bubble">
                <i class="fas fa-thermometer-empty"></i>
                <h3>No Cold Rooms Available</h3>
                {% if location %}
                    <p>No cold rooms configured for {{ location.name }}</p>
                {% else %}
                    <p>Please select a location to view temperature data</p>
                {% endif %}
            </div>
        {% endif %}
    </div>
</div>

<script>
// Location selector functionality
function changeLocation(locationId) {
    if (locationId) {
        window.location.href = `{{ url_for('user_dashboard') }}?location_id=${locationId}`;
    } else {
        window.location.href = `{{ url_for('user_dashboard') }}`;
    }
}

// Auto-refresh functionality
setTimeout(function() {
    window.location.reload();
}, 30000); // Refresh every 30 seconds
</script>

<style>
/* Simple Dashboard Styles */
.simple-dashboard {
    min-height: 100vh;
    background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
    font-family: 'Inter', sans-serif;
}

/* Header Section */
.header-section {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(20px);
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
    position: sticky;
    top: 0;
    z-index: 100;
}

.header-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 1.5rem 2rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.site-title {
    font-size: 2rem;
    font-weight: 700;
    color: #2c3e50;
    margin: 0;
    display: flex;
    align-items: center;
    gap: 0.75rem;
}

.site-title i {
    color: #1E88E5;
    font-size: 1.8rem;
}

.location-selector {
    padding: 0.75rem 1.25rem;
    border: 2px solid #e9ecef;
    border-radius: 12px;
    background: white;
    font-size: 1rem;
    font-weight: 500;
    color: #2c3e50;
    cursor: pointer;
    transition: all 0.3s ease;
    min-width: 200px;
}

.location-selector:focus {
    outline: none;
    border-color: #1E88E5;
    box-shadow: 0 0 0 4px rgba(30, 136, 229, 0.15);
}

/* Main Content */
.main-content {
    max-width: 1200px;
    margin: 0 auto;
    padding: 3rem 2rem;
}

/* Temperature Bubble Card */
.temp-bubble-card {
    background: white;
    border-radius: 24px;
    box-shadow: 0 8px 40px rgba(0, 0, 0, 0.12);
    padding: 2.5rem;
    margin-bottom: 2rem;
    position: relative;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

.temp-bubble-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 12px 60px rgba(0, 0, 0, 0.15);
}

/* Online/Offline Status (Top Right Corner) */
.status-indicator-corner {
    position: absolute;
    top: 1.5rem;
    right: 1.5rem;
}

.status-badge {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 1rem;
    border-radius: 20px;
    font-size: 0.85rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.status-badge.online {
    background: rgba(40, 167, 69, 0.15);
    color: #28a745;
    border: 2px solid rgba(40, 167, 69, 0.3);
}

.status-badge.offline {
    background: rgba(108, 117, 125, 0.15);
    color: #6c757d;
    border: 2px solid rgba(108, 117, 125, 0.3);
}

/* Room Title */
.room-title {
    margin-bottom: 2rem;
}

.room-title h2 {
    font-size: 1.8rem;
    font-weight: 600;
    color: #2c3e50;
    margin: 0;
    font-family: 'Poppins', sans-serif;
}

/* Temperature Layout */
.temp-layout {
    display: flex;
    align-items: center;
    gap: 3rem;
}

/* Left Side: Big Current Temperature */
.current-temp-section {
    flex: 2;
    display: flex;
    flex-direction: column;
    align-items: flex-start;
}

.big-temperature {
    font-size: 5rem;
    font-weight: 700;
    color: #00A8E8;
    font-family: 'Roboto Mono', monospace;
    line-height: 1;
    text-shadow: 0 4px 8px rgba(0, 168, 232, 0.2);
    margin-bottom: 1rem;
}

.no-data-temp {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 1rem;
    color: #6c757d;
    font-size: 1.5rem;
}

.no-data-temp i {
    font-size: 3rem;
    opacity: 0.5;
}

/* Received Time (Below Temperature) */
.received-time {
    font-size: 1rem;
    color: #6c757d;
    font-weight: 500;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.received-time.offline {
    color: #dc3545;
}

/* Right Side: Stats Section */
.stats-section {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
    padding: 1rem;
    background: rgba(248, 249, 250, 0.8);
    border-radius: 16px;
    border-left: 4px solid #1E88E5;
}

.stat-item {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
}

.stat-label {
    font-size: 0.8rem;
    font-weight: 600;
    color: #6c757d;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.stat-value {
    font-size: 1.4rem;
    font-weight: 700;
    font-family: 'Roboto Mono', monospace;
}

.stat-item.avg .stat-value {
    color: #1E88E5;
}

.stat-item.min .stat-value {
    color: #17a2b8;
}

.stat-item.max .stat-value {
    color: #dc3545;
}

.no-stats {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.75rem;
    color: #6c757d;
    padding: 2rem;
    text-align: center;
}

.no-stats i {
    font-size: 2rem;
    opacity: 0.5;
}

/* No Data State */
.no-data-bubble {
    background: white;
    border-radius: 24px;
    box-shadow: 0 8px 40px rgba(0, 0, 0, 0.08);
    padding: 4rem 2rem;
    text-align: center;
    color: #6c757d;
}

.no-data-bubble i {
    font-size: 4rem;
    margin-bottom: 1.5rem;
    opacity: 0.4;
}

.no-data-bubble h3 {
    color: #2c3e50;
    margin-bottom: 1rem;
}

/* Responsive Design */
@media (max-width: 768px) {
    .header-container {
        flex-direction: column;
        gap: 1rem;
        padding: 1rem;
    }

    .site-title {
        font-size: 1.5rem;
    }

    .main-content {
        padding: 2rem 1rem;
    }

    .temp-bubble-card {
        padding: 2rem 1.5rem;
    }

    .temp-layout {
        flex-direction: column;
        gap: 2rem;
        align-items: stretch;
    }

    .big-temperature {
        font-size: 3.5rem;
        text-align: center;
    }

    .current-temp-section {
        align-items: center;
        text-align: center;
    }

    .stats-section {
        flex-direction: row;
        justify-content: space-around;
        padding: 1.5rem 1rem;
    }

    .stat-item {
        text-align: center;
        min-width: 80px;
    }

    .stat-value {
        font-size: 1.2rem;
    }
}

@media (max-width: 480px) {
    .big-temperature {
        font-size: 2.8rem;
    }

    .stats-section {
        flex-direction: column;
        gap: 1rem;
    }

    .stat-item {
        text-align: left;
    }
}
</style>
{% endblock %}